{# src/web/templates/admin/edit_order.html #}
{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto p-6 bg-white shadow-md rounded-lg">
  <h2 class="text-2xl font-bold mb-6 text-center">編輯訂單</h2>
  <form method="POST" action="{{ url_for('admin.update_order', order_id=order.order_id) }}" class="space-y-6">

    <!-- Confirmed Order Switch -->
    <div class="flex items-center justify-between">
      <span class="text-sm font-medium text-gray-700">是否確認訂單</span>
      <label class="inline-flex relative items-center cursor-pointer">
        <input type="hidden" name="confirmed_order" value="false">
        <input type="checkbox" name="confirmed_order" value="CONFIRMED" {% if order.confirmed_order=='CONFIRMED'
          %}checked{% endif %} class="sr-only peer">
        <div
          class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:bg-green-500 transition-all duration-300">
        </div>
        <div
          class="absolute left-1 top-1 w-4 h-4 bg-white border border-gray-300 rounded-full transition-transform duration-300 peer-checked:translate-x-full">
        </div>
      </label>
    </div>

    <!-- Deliver Date -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">出貨日期</label>
      <input type="date" name="deliver_date"
        value="{{ order.deliver_date.strftime('%Y-%m-%d') if order.deliver_date else '' }}" required
        class="w-full px-3 py-2 border border-gray-300 rounded">
    </div>

    <!-- Deliver Status -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">出貨狀態</label>
      <select name="deliver_status" class="w-full px-3 py-2 border border-gray-300 rounded">
        <option value="PREPARE" {% if order.deliver_status=='PREPARE' %}selected{% endif %}>備貨中</option>
        <option value="DELIVERING" {% if order.deliver_status=='DELIVERING' %}selected{% endif %}>配送中</option>
        <option value="DELIVERED" {% if order.deliver_status=='DELIVERED' %}selected{% endif %}>已送達</option>
      </select>
    </div>

    <!-- 操作按鈕 -->
    <div class="pt-4 flex justify-center space-x-4">
      <button type="submit"
        class="flex items-center space-x-2 bg-gray-700 hover:bg-gray-800 text-white px-5 py-2 rounded-xl shadow transition">
        <i class="fas fa-save"></i>
        <span>儲存修改</span>
      </button>

      <a href="{{ url_for('admin.show_orders') }}"
        class="flex items-center space-x-2 bg-white text-gray-700 hover:bg-gray-100 border border-gray-300 px-5 py-2 rounded-xl shadow transition">
        <i class="fas fa-arrow-left"></i>
        <span>返回列表</span>
      </a>
    </div>
    <div class="mt-6 p-4 border border-gray-300 rounded bg-gray-50 text-sm text-gray-700">
      <p><strong>目前是否確認訂單：</strong> <span id="debug-confirmed">（尚未選擇）</span></p>
      <p><strong>目前出貨日期：</strong> <span id="debug-date">（尚未選擇）</span></p>
      <p><strong>目前出貨狀態：</strong> <span id="debug-status">（尚未選擇）</span></p>
    </div>
    <script>
      const confirmedInput = document.querySelector('input[name="confirmed_order"][value="CONFIRMED"]');
      const deliverDateInput = document.querySelector('input[name="deliver_date"]');
      const deliverStatusSelect = document.querySelector('select[name="deliver_status"]');

      function updateDebug() {
        document.getElementById("debug-confirmed").innerText = confirmedInput.checked ? "CONFIRMED" : "PENDING";
        document.getElementById("debug-date").innerText = deliverDateInput.value || "（尚未選擇）";
        document.getElementById("debug-status").innerText = deliverStatusSelect.value || "（尚未選擇）";
      }

      // 綁定事件
      confirmedInput.addEventListener("change", updateDebug);
      deliverDateInput.addEventListener("input", updateDebug);
      deliverStatusSelect.addEventListener("change", updateDebug);

      // 初始顯示
      updateDebug();
    </script>

  </form>
</div>
{% endblock %}
